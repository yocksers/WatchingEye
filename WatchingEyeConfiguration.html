﻿﻿<div is="emby-scroller" class="view flex flex-direction-column scrollFrameY flex-grow" data-horizontal="false" data-forcescrollbar="true" data-centerfocus="true" data-bindheader="true" data-controller="__plugin/WatchingEyeConfigurationjs" data-title="Watching Eye">
    <style>
        .disabled-item .listItemBody, .disabled-item .listItemBody .secondary {
            color: #999;
        }

        .logging-list .listItem:not(:first-child) {
            border-top: 1px solid #222;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-editor {
            padding: 1.5em;
            background: rgba(0,0,0,.2);
            border-radius: 5px;
        }

            .user-editor h3 {
                margin: 1em 0;
            }

            .user-editor .inputContainer {
                margin-top: 1em;
            }

        .user-editor-flex-container {
            display: flex;
            gap: 1.5em;
            flex-wrap: wrap;
        }

            .user-editor-flex-container > div {
                flex-grow: 1;
                min-width: 200px;
            }

        .user-editor-buttons {
            margin-top: 1.5em;
            display: flex;
            gap: 1em;
        }
    </style>
    <div class="scrollSlider flex-grow flex-direction-column padded-left padded-left-page padded-right padded-top-page padded-bottom-page">
        <div class="readOnlyContent auto-center" style="max-width: 1200px;">
            <h1 class="pageTitle">Watching Eye</h1>

            <div data-role="controlgroup" data-type="horizontal" class="localnav">
                <a is="emby-linkbutton" class="nav-button" href="#" data-role="button" data-target="notificationsPage">Notifications</a>
                <a is="emby-linkbutton" class="nav-button ui-btn-active" href="#" data-role="button" data-target="limiterPage">Watch Time Limiter</a>
                <a is="emby-linkbutton" class="nav-button" href="#" data-role="button" data-target="loggingPage">Logging</a>
            </div>

            <form class="watchingEyeForm">
                <div id="notificationsPage" class="hide">
                    <div class="paper-card" style="padding: 1.5em; margin-top: 2em;">
                        <h2 style="margin-top: 0;">Transcode Notification</h2>
                        <div class="checkboxContainer">
                            <label><input is="emby-checkbox" type="checkbox" id="chkEnableTranscodeWarning" data-config-key="EnableTranscodeWarning" /><span>Enable Transcode Warning</span></label>
                            <div class="fieldDescription">If enabled, a notification will be sent when a video starts transcoding.</div>
                        </div>
                        <div class="inputContainer">
                            <input is="emby-input" type="text" id="txtMessageText" label="Message Text:" data-config-key="MessageText" />
                            <div class="fieldDescription">The text to display when transcoding starts. Use {reason} to include the transcode reason.</div>
                        </div>
                        <div class="inputContainer">
                            <input is="emby-input" type="number" id="numMaxNotifications" label="Max Notifications per Session:" data-config-key="MaxNotifications" />
                        </div>
                        <div class="inputContainer">
                            <input is="emby-input" type="number" id="numInitialDelaySeconds" label="Initial Delay (seconds):" data-config-key="InitialDelaySeconds" />
                        </div>
                        <div class="inputContainer">
                            <input is="emby-input" type="number" id="numDelayBetweenMessagesSeconds" label="Delay Between Messages (seconds):" data-config-key="DelayBetweenMessagesSeconds" />
                        </div>
                        <div class="checkboxContainer">
                            <label><input is="emby-checkbox" type="checkbox" id="chkNotifyOnAudioOnlyTranscode" data-config-key="NotifyOnAudioOnlyTranscode" /><span>Notify on Audio-Only Transcode</span></label>
                        </div>
                    </div>

                    <div class="paper-card" style="padding: 1.5em; margin-top: 2em;">
                        <h2 style="margin-top: 0;">Direct Play Notification</h2>
                        <div class="checkboxContainer">
                            <label><input is="emby-checkbox" type="checkbox" id="chkNotifyOnDirectPlay" data-config-key="NotifyOnDirectPlay" /><span>Notify on Direct Play</span></label>
                        </div>
                        <div class="inputContainer">
                            <input is="emby-input" type="text" id="txtDirectPlayMessageText" label="Direct Play Message Text:" data-config-key="DirectPlayMessageText" />
                        </div>
                    </div>

                    <div class="paper-card" style="padding: 1.5em; margin-top: 2em;">
                        <h2 style="margin-top: 0;">Playback Start Notification</h2>
                        <div class="checkboxContainer">
                            <label><input is="emby-checkbox" type="checkbox" id="chkEnablePlaybackStartNotification" data-config-key="EnablePlaybackStartNotification" /><span>Enable Playback Start Notification</span></label>
                        </div>
                        <div class="inputContainer">
                            <input is="emby-input" type="text" id="txtPlaybackStartMessageText" label="Playback Start Message Text:" data-config-key="PlaybackStartMessageText" />
                        </div>
                        <div class="inputContainer">
                            <input is="emby-input" type="number" id="numPlaybackStartInitialDelaySeconds" label="Initial Delay (seconds):" data-config-key="PlaybackStartInitialDelaySeconds" />
                        </div>
                        <div class="inputContainer">
                            <input is="emby-input" type="number" id="numPlaybackStartMaxNotifications" label="Max Notifications per Session:" data-config-key="PlaybackStartMaxNotifications" />
                        </div>
                        <div class="inputContainer">
                            <input is="emby-input" type="number" id="numPlaybackStartDelayBetweenMessagesSeconds" label="Delay Between Messages (seconds):" data-config-key="PlaybackStartDelayBetweenMessagesSeconds" />
                        </div>
                    </div>

                    <div class="paper-card" style="padding: 1.5em; margin-top: 2em;">
                        <h2 style="margin-top: 0;">General Notification Settings</h2>
                        <div class="checkboxContainer">
                            <label><input is="emby-checkbox" type="checkbox" id="chkEnableConfirmationButton" data-config-key="EnableConfirmationButton" /><span>Enable Confirmation Button</span></label>
                            <div class="fieldDescription">If enabled, ALL notifications from this plugin will require manual dismissal (no timeout).</div>
                        </div>
                        <div class="inputContainer">
                            <input is="emby-input" type="text" id="txtExcludedUserNames" label="Excluded Users (comma-separated):" data-config-key="ExcludedUserNames" />
                        </div>
                        <div class="inputContainer">
                            <input is="emby-input" type="text" id="txtExcludedClients" label="Excluded Clients (comma-separated):" data-config-key="ExcludedClients" />
                        </div>
                    </div>
                </div>

                <!-- Watch Time Limiter Page -->
                <div id="limiterPage">
                    <div class="paper-card" style="padding: 1.5em; margin-top: 2em;">
                        <div class="checkboxContainer">
                            <label><input is="emby-checkbox" type="checkbox" id="chkEnableWatchTimeLimiter" data-config-key="EnableWatchTimeLimiter" /><span>Enable Watch Time Limiter</span></label>
                            <div class="fieldDescription">If enabled, specified users will have a time limit on their watch time.</div>
                        </div>

                        <div class="checkboxContainer">
                            <label><input is="emby-checkbox" type="checkbox" id="chkEnableWatchLimitNotifications" data-config-key="EnableWatchLimitNotifications" /><span>Enable Server Notifications (e.g., Pushover)</span></label>
                            <div class="fieldDescription">Sends a notification through Emby's notification system when a user reaches their time limit or a warning threshold.</div>
                        </div>

                        <div class="inputContainer">
                            <input is="emby-input" type="text" id="txtWatchTimeLimitMessageText" label="Limit Reached Message Text:" data-config-key="WatchTimeLimitMessageText" />
                        </div>
                        <div class="inputContainer">
                            <input is="emby-input" type="text" id="txtTimeWindowBlockedMessageText" label="Time Window Blocked Message Text:" data-config-key="TimeWindowBlockedMessageText" />
                        </div>

                        <h3 style="margin-top:2em;">Limited Users</h3>
                        <div id="limitedUsersContainer">
                        </div>
                        <button is="emby-button" type="button" class="raised button-submit" id="btnAddLimitedUser" style="margin-top: 1em;">
                            <span>Add User</span>
                        </button>
                        <button is="emby-button" type="button" class="raised button-cancel" id="btnResetAll" style="margin-top: 1em;">
                            <span>Reset All Users</span>
                        </button>
                    </div>
                </div>

                <!-- Logging Page -->
                <div id="loggingPage" class="hide">
                    <div class="paper-card" style="padding: 1.5em; margin-top: 2em;">
                        <div class="page-header">
                            <h2 style="margin:0;">Event Log</h2>
                            <button is="emby-button" type="button" class="raised button-cancel" id="btnClearLog">
                                <span>Clear Log</span>
                            </button>
                        </div>
                        <div class="fieldDescription">Shows the last 200 events, such as when users hit their time limit or trigger a transcode.</div>
                        <div id="logContainer" class="logging-list" style="margin-top:1.5em;">
                            <!-- Content generated by JS -->
                        </div>
                    </div>
                </div>

                <div style="margin-top: 2em;">
                    <button is="emby-button" type="submit" class="raised button-submit block">
                        <span>Save</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>